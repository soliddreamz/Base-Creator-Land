<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Base Fan App</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0b0b0f;
  color:white;
  transition:background-color 0.3s ease;
}
header{
  padding:16px;
  border-bottom:1px solid #222;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
section{ padding:16px; }
.badge{ padding:6px 10px; border-radius:20px; background:#222; font-size:12px; }
.links{ display:grid; gap:10px; max-width:520px; }
a.btn{
  display:flex; justify-content:space-between; align-items:center;
  padding:12px 14px; border:1px solid #222; border-radius:12px;
  color:white; text-decoration:none; background:#0a0a0a;
}
.emailBox{ margin-top:20px; max-width:520px; display:flex; gap:8px; }
.emailStatus{ font-size:12px; opacity:.7; margin-top:6px; }
</style>
</head>

<body>

<header>
  <div>
    <h2 id="name" style="margin:0 0 6px 0;">Creator Name</h2>
    <div class="badge" id="live">OFFLINE</div>
  </div>
</header>

<section>
  <p id="bio">Bio goes here</p>
  <div class="links" id="links"></div>
  <div id="emailContainer"></div>
</section>

<script>
const CONTENT_URL="./content.json";
const POLL_INTERVAL=15000;

function applyState(d){
  if(!d) return;
  document.getElementById("name").textContent=d.name||"";
  document.getElementById("bio").textContent=d.bio||"";

  if(d.backgroundColor)
    document.body.style.background=d.backgroundColor;

  const liveOn=d.isLive===true;
  document.getElementById("live").textContent=liveOn?"LIVE":"OFFLINE";

  const linksEl=document.getElementById("links");
  linksEl.innerHTML="";
  (Array.isArray(d.links)?d.links:[]).forEach(item=>{
    if(!item||!item.url) return;
    const a=document.createElement("a");
    a.className="btn";
    a.href=item.url;
    a.target="_blank";
    a.rel="noopener";
    a.textContent=item.label||item.url;
    linksEl.appendChild(a);
  });

  if(d.emailCapture===true && d.emailEndpoint){
    renderEmail(d.emailEndpoint);
  }
}

function renderEmail(endpoint){
  const container=document.getElementById("emailContainer");
  container.innerHTML="";
  const box=document.createElement("div");
  box.className="emailBox";
  const input=document.createElement("input");
  input.type="email";
  input.placeholder="Enter your email";
  const btn=document.createElement("button");
  btn.textContent="Join";
  const status=document.createElement("div");
  status.className="emailStatus";
  btn.onclick=async()=>{
    const email=input.value.trim();
    if(!email) return;
    try{
      await fetch(endpoint,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({email})
      });
      status.textContent="You're in.";
      input.value="";
    }catch(e){
      status.textContent="Submission failed.";
    }
  };
  box.appendChild(input);
  box.appendChild(btn);
  container.appendChild(box);
  container.appendChild(status);
}

async function fetchState(){
  const url=new URL(CONTENT_URL,location.href);
  url.searchParams.set("ts",Date.now());
  const r=await fetch(url.toString(),{cache:"no-store"});
  if(!r.ok) throw new Error();
  return r.json();
}

async function tick(){
  try{
    const state=await fetchState();
    applyState(state);
  }catch(e){}
}

tick();
setInterval(tick,POLL_INTERVAL);
document.addEventListener("visibilitychange",()=>{
  if(!document.hidden) tick();
});
</script>

</body>
</html>
